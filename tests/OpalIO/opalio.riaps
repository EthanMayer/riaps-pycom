// RIAPS Demo with OPAL-RT

app OpalIO {
    message C37Data;   		// tuple: raw frame (bytes), dictionary of interpreted values 
    message C37Header;		// tuple: string
    message C37Config;		// tuple: raw frame (bytes), dictionary of interpreted values
    
    library pypmu;
     
    device C37Receiver(pmu_ip='127.0.0.1', pmu_port=9876) {
      inside data_queue /* default */; 	// Inside port for forwarding messages coming from an internal thread.
      								// The 'default' is optional, it implies a 1 sec timer/ticker thread.
      inside config_queue;
      inside header_queue;
      
      timer clock 2000;
      pub c37data : C37Data;	// Publish port for received C37 data messages 
      pub c37header : C37Header;	// Publish port for received C37 header messages
      pub c37config : C37Config;	// Publish port for received C37 config messages
    }
    
    // Data Processor component
    component Processor() {
      sub rx_c37data : C37Data;
      sub rx_c37header : C37Header;
      sub rx_c37config : C37Config;
    }

    // PDC actor
    actor OpalIOActor() {
       local C37Data, C37Header, C37Config;
       {
       	  c37receiver : C37Receiver(pmu_ip='127.0.0.1', pmu_port=9876);
          processor : Processor(); 		
       }
    }
}
